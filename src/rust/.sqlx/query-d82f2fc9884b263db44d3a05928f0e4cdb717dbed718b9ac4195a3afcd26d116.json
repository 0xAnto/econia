{
  "db_name": "PostgreSQL",
  "query": "WITH parameters AS (\n    SELECT\n        $1::numeric fill_size,\n        $2::numeric fill_order_id,\n        $3::numeric fill_market_id,\n        $4::timestamptz fill_time,\n        $5::numeric fill_price)\nUPDATE\n    aggregator.user_history\nSET\n    remaining_size = remaining_size - fill_size,\n    total_filled = total_filled + fill_size,\n    order_status = CASE order_type\n    WHEN 'limit' THEN\n        CASE remaining_size - fill_size\n        WHEN 0 THEN\n            'closed'\n        ELSE\n            order_status\n        END\n    ELSE\n        'closed'\n    END,\n    last_updated_at = fill_time,\n    average_execution_price = (total_filled * COALESCE(average_execution_price, 0) + fill_size * fill_price) / (total_filled + fill_size)\nFROM\n    parameters\nWHERE\n    order_id = fill_order_id\n    AND market_id = fill_market_id\n",
  "describe": {
    "columns": [],
    "parameters": {
      "Left": [
        "Numeric",
        "Numeric",
        "Numeric",
        "Timestamptz",
        "Numeric"
      ]
    },
    "nullable": []
  },
  "hash": "d82f2fc9884b263db44d3a05928f0e4cdb717dbed718b9ac4195a3afcd26d116"
}
